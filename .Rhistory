getwd()
use_mit_license()
library(license)
library(usethis)
use_mit_license()
example(source)
try(roxygen2::roxygenize(load_code = sourceDir), silent = TRUE)
pkgbuild::compile_dll()
roxygen2::roxygenize()
install.packages("../trystan", repos = NULL, type = "source")
devtools::load_all()
fit <- lm_stan(y = rnorm(10), x = rnorm(10),
# arguments passed to sampling
iter = 2000, refresh = 500)
fit
devtools::document()
use_package("purrr")
use_package("dplyr")
devtools::load_all()
getwd()
setwd("C:/Users/isaac/Documents/Simon_Lab/TimeLapse_Paper/Real_Data/")
rm(fit)
cB_test <- readRDS("cB.rds")
# Define experimental design:
samp_list <- c('JS181101', 'JS181102','JS181107', 'JS181108',
'JS181113', 'JS181114')
c_list <- c('JS181113', 'JS181114')
type_list <- c(1, 1, 1, 1, 0, 0)
mut_list <- c(1, 1, 2, 2, 1 ,2)
rep_list <- c(rep(c(1,2), times=2), 1, 1)
data_list <- cB_to_Stan(cB_test, c_list, type_list, mut_list, rep_list, 2, 2, keep_input = c(0.2, 1000))
devtools::load_all()
getwd()
setwd("C:/Users/isaac/Documents/Simon_Lab/trystan/")
devtools::load_all()
data_list <- cB_to_Stan(cB_test, c_list, type_list, mut_list, rep_list, 2, 2, keep_input = c(0.2, 1000))
devtools::document()
devtools::load_all()
getwd()
data_list <- cB_to_Stan(cB_test, c_list, type_list, mut_list, rep_list, 2, 2, keep_input = c(0.2, 1000))
devtools::document()
devtools::load_all()
data_list <- cB_to_Stan(cB_test, c_list, type_list, mut_list, rep_list, 2, 2, keep_input = c(0.2, 1000))
data_list <- trystan::cB_to_Stan(cB_test, c_list, type_list, mut_list, rep_list, 2, 2, keep_input = c(0.2, 1000))
devtools::document()
devtools::load_all()
data_list <- trystan::cB_to_Stan(cB_test, c_list, type_list, mut_list, rep_list, 2, 2, keep_input = c(0.2, 1000))
getwd()
devtools::load_all()
getwd()
setwd("C:/Users/isaac/Documents/Simon_Lab/TimeLapse_Paper/Real_Data/")
require(devtools)
library(tidvy)
library(tidyverse)
library(roxygen2)
devtools::document()
devtools::load_all()
getwd()
setwd("C:/Users/isaac/Documents/Simon_Lab/TimeLapse_Paper/Real_Data/")
cB_test <- readRDS("cB.rds")
setwd("C:/Users/isaac/Documents/Simon_Lab/DynamicSeq")
c_list <- c('JS181113', 'JS181114')
type_list <- c(1, 1, 1, 1, 0, 0)
mut_list <- c(1, 1, 2, 2, 1 ,2)
rep_list <- c(rep(c(1,2), times=2), 1, 1)
data_list <- cBtoStan(cB_test, c_list, type_list, mut_list, rep_list, 2, 2, c(0.2, 5000))
fit <- TL_stan(data_list, iter=1000, warmup=500, chains=1)
data_list <- cBtofast(cB_test, c_list, type_list, mut_list, rep_list, 2, 2, c(0.2, 5000))
data_list <- cBtofast(cB_test, c_list, type_list, mut_list, rep_list, 2, 2, c(0.2, 500))
fn_df <- fast_analysis(df=data_list)
fn_df
nrow(fn_df)
fn_df <- DynamicSeq::fast_analysis(df=data_list)
data_list
fn_df <- DynamicSeq::fast_analysis(df=data_list, boot_iter = 100)
?mean()
as.data.frame(data_list)
data_df <- as.data.frame(data_list)
fn_df <- DynamicSeq::fast_analysis(df=data_df, boot_iter = 50)
fn_df
view(fn_df)
devtools::load_all()
devtools::load_all()
devtools::document()
library(roxygen2)
getwd()
setwd("C:/Users/isaac/Documents/Simon_Lab/TimeLapse_Paper/Real_Data/")
cB <- readRDS("cB.rds")
setwd("C:/Users/isaac/Documents/Simon_Lab/DynamicSeq")
c_list <- c('JS181113', 'JS181114')
type_list <- c(1, 1, 1, 1, 0, 0)
mut_list <- c(1, 1, 2, 2, 1 ,2)
rep_list <- c(rep(c(1,2), times=2), 1, 1)
cBtofast(cB, c_list, type_list, mut_list, rep_list, 2, 2, c(0.2, 500))
fast_df <- cBtofast(cB, c_list, type_list, mut_list, rep_list, 2, 2, c(0.2, 500))
fn_df <- fast_analysis(fast_df)
df <- fast_df
#Old mutation rate estimation
Mut_data <- df[,1:9]
colnames(Mut_data) <- c("sample", "XF", "TC", "nT", "n", "fnum", "type", "mut", "reps")
Old_data <- Mut_data[Mut_data$type == 0, ]
Old_data$avg_mut <- Old_data$TC/Old_data$nT
Old_data$avg_mut[is.na(Old_data$avg_mut)] <- 0
Old_data$weight_mut <- Old_data$avg_mut*Old_data$n
Old_data_summary <- Old_data %>%
dplyr::group_by(reps, mut, fnum) %>%
dplyr::do(purrr::invoke_map_dfc(list(map_df),
list(list(dplyr::select(., weight_mut), sum),
list(dplyr::select(., n), sum))
)
)
?invoke_map_dfc()
library(tidyverse)
Old_data_summary <- Old_data %>%
dplyr::group_by(reps, mut, fnum) %>%
dplyr::do(purrr::invoke_map_dfc(list(map_df),
list(list(dplyr::select(., weight_mut), sum),
list(dplyr::select(., n), sum))
)
)
fn_df <- fast_analysis(fast_df)
?rbernoulli
devtools::load_all()
fn_df <- fast_analysis(fast_df)
fn_df
data_list
data_list <- cBtoStan(cB, c_list, type_list, mut_list, rep_list, 2, 2, c(0.2, 500))
library(rstan)
# Load stan
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
fit <- TL_stan(data_list, iter=2000, refresh=500)
fit <- TL_stan(data_list, iter=2000, chains=1)
devtools::load_all()
library(rstan)
delta <- 0.5/0.25
pnorm(1 + delta, lower.tail = FALSE)
pnorm(1 - delta, lower.tail = FALSE)
mean <- 0.25
sd <- 0.25
mu <- 0.5
tstat <- mean/sd
delta <- mu/sd
test <- pnorm(tstat + delta, lower.tail=ifelse(mean >0, FALSE, TRUE)) + pnorm(tstat - delta, lower.tail=ifelse(mean >0, FALSE, TRUE))
test
delta <- -mu/sd
test <- pnorm(tstat + delta, lower.tail=ifelse(mean >0, FALSE, TRUE)) + pnorm(tstat - delta, lower.tail=ifelse(mean >0, FALSE, TRUE))
test
mean <- 0.25
sd <- 0.05
mu <- 0.5
tstat <- mean/sd
delta <- -mu/sd
test <- pnorm(tstat + delta, lower.tail=ifelse(mean >0, FALSE, TRUE)) + pnorm(tstat - delta, lower.tail=ifelse(mean >0, FALSE, TRUE))
test
delta <- mu/sd
test <- pnorm(tstat + delta, lower.tail=ifelse(mean >0, FALSE, TRUE)) + pnorm(tstat - delta, lower.tail=ifelse(mean >0, FALSE, TRUE))
test
mean <- -0.25
sd <- 0.05
mu <- 0.5
tstat <- mean/sd
delta <- mu/sd
test <- pnorm(tstat + delta, lower.tail=ifelse(mean >0, FALSE, TRUE)) + pnorm(tstat - delta, lower.tail=ifelse(mean >0, FALSE, TRUE))
test
mean <- -0.45
sd <- 0.05
mu <- 0.5
tstat <- mean/sd
delta <- mu/sd
test <- pnorm(tstat + delta, lower.tail=ifelse(mean >0, FALSE, TRUE)) + pnorm(tstat - delta, lower.tail=ifelse(mean >0, FALSE, TRUE))
test
mean <- -0.49
sd <- 0.05
mu <- 0.5
tstat <- mean/sd
delta <- mu/sd
test <- pnorm(tstat + delta, lower.tail=ifelse(mean >0, FALSE, TRUE)) + pnorm(tstat - delta, lower.tail=ifelse(mean >0, FALSE, TRUE))
test
mean <- -0.5
sd <- 0.05
mu <- 0.5
tstat <- mean/sd
delta <- mu/sd
test <- pnorm(tstat + delta, lower.tail=ifelse(mean >0, FALSE, TRUE)) + pnorm(tstat - delta, lower.tail=ifelse(mean >0, FALSE, TRUE))
test
mean
print
require(tidyverse)
library(rstan)
library(loo)
require(extrafont)
library(bayesplot)
require(EnvStats)
library(devtools)
setwd("C:/Users/isaac/Documents/Simon_Lab/DynamicSeq/")
devtools::load_all()
setwd("C:/Users/isaac/Documents/Simon_Lab/TimeLapse_Paper/Real_Data/")
#Load cB
cB <- readRDS("cB.rds")
# Define experimental design:
samp_list <- c('JS181101', 'JS181102','JS181107', 'JS181108',
'JS181113', 'JS181114')
type_list <- c(1, 1, 1, 1, 0, 0)
mut_list <- c(1, 1, 2, 2, 1 ,2)
rep_list <- c(rep(c(1,2), times=2), 1, 1)
tl <- 2 #label time
keep_params <- c(0.2, 50) #1st entry is mut rate cutoff for control sample; second is read count cutoff
#Process cB for fast analysis
df_fast <- cB_to_fast(cB,
samp_list,
type_list,
mut_list,
rep_list,
tl)
#Process cB for fast analysis
df_fast <- cBtofast(cB,
samp_list,
type_list,
mut_list,
rep_list,
tl)
#Analyze data with fast analysis
df_fn <- fast_analysis(df_fast, pnew = 0.11783, pold = 0.00196)
fn_list <- df_fn
df_fn <- fn_list[[1]]
#Look for heteroskedasticity
library(data.table)
#Convert to data.table
dt_fn <- setDT(df_fn)
#Take an even number of genes in each condition
subsection <- 9000
ans <- dt_fn[Gene_ID < subsection, .(sd_fn = sd(logit_fn), mean_fn = mean(logit_fn)), by=.(Condition, Gene_ID)
][order(mean_fn)]
#Extract mean logit(fraction new) and standard deviation of logit(fn)
avg_fn <- ans[,mean_fn]
sd_fn <- ans[,sd_fn]
#Defining binning parameters for binned averaging analysis
bins <- 1000
bin_size <- (2*subsection)/bins
mean_bin_fn <- rep(0, times=bins)
sd_bin_fn <- rep(0, times=bins)
#Bin data and find average logit(fn) and sd(logit(fn))
for(i in 1:bins){
low_index <- (i - 1)*bin_size + 1
high_index <- i*bin_size
mean_bin_fn[i] <- mean(avg_fn[low_index:high_index])
sd_bin_fn[i] <- mean(sd_fn[low_index:high_index])
}
#Plot results
plot(mean_bin_fn, sd_bin_fn)
plot(avg_fn, sd_fn)
#Plot results
plot(mean_bin_fn, sd_bin_fn)
#Defining binning parameters for binned averaging analysis
bins <- 500
bin_size <- (2*subsection)/bins
mean_bin_fn <- rep(0, times=bins)
sd_bin_fn <- rep(0, times=bins)
#Bin data and find average logit(fn) and sd(logit(fn))
for(i in 1:bins){
low_index <- (i - 1)*bin_size + 1
high_index <- i*bin_size
mean_bin_fn[i] <- mean(avg_fn[low_index:high_index])
sd_bin_fn[i] <- mean(sd_fn[low_index:high_index])
}
#Plot results
plot(mean_bin_fn, sd_bin_fn)
#Defining binning parameters for binned averaging analysis
bins <- 200
bin_size <- (2*subsection)/bins
mean_bin_fn <- rep(0, times=bins)
sd_bin_fn <- rep(0, times=bins)
#Bin data and find average logit(fn) and sd(logit(fn))
for(i in 1:bins){
low_index <- (i - 1)*bin_size + 1
high_index <- i*bin_size
mean_bin_fn[i] <- mean(avg_fn[low_index:high_index])
sd_bin_fn[i] <- mean(sd_fn[low_index:high_index])
}
#Plot results
plot(mean_bin_fn, sd_bin_fn)
#Defining binning parameters for binned averaging analysis
bins <- 100
bin_size <- (2*subsection)/bins
mean_bin_fn <- rep(0, times=bins)
sd_bin_fn <- rep(0, times=bins)
#Bin data and find average logit(fn) and sd(logit(fn))
for(i in 1:bins){
low_index <- (i - 1)*bin_size + 1
high_index <- i*bin_size
mean_bin_fn[i] <- mean(avg_fn[low_index:high_index])
sd_bin_fn[i] <- mean(sd_fn[low_index:high_index])
}
#Plot results
plot(mean_bin_fn, sd_bin_fn)
nrow(ans)
#Defining binning parameters for binned averaging analysis
bins <- 50
bin_size <- (2*subsection)/bins
mean_bin_fn <- rep(0, times=bins)
sd_bin_fn <- rep(0, times=bins)
#Bin data and find average logit(fn) and sd(logit(fn))
for(i in 1:bins){
low_index <- (i - 1)*bin_size + 1
high_index <- i*bin_size
mean_bin_fn[i] <- mean(avg_fn[low_index:high_index])
sd_bin_fn[i] <- mean(sd_fn[low_index:high_index])
}
#Plot results
plot(mean_bin_fn, sd_bin_fn)
