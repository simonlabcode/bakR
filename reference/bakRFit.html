<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimating kinetic parameters from nucleotide recoding RNA-seq data — bakRFit • bakR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimating kinetic parameters from nucleotide recoding RNA-seq data — bakRFit"><meta name="description" content="bakRFit analyzes nucleotide recoding RNA-seq data to estimate
kinetic parameters relating to RNA stability and changes in RNA
stability induced by experimental perturbations. Several statistical
models of varying efficiency and accuracy can be used to fit data."><meta property="og:description" content="bakRFit analyzes nucleotide recoding RNA-seq data to estimate
kinetic parameters relating to RNA stability and changes in RNA
stability induced by experimental perturbations. Several statistical
models of varying efficiency and accuracy can be used to fit data."><meta property="og:image" content="https://simonlabcode.github.io/bakR/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bakR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Getting-Started.html">Differential kinetic analysis with bakR</a></li>
    <li><a class="dropdown-item" href="../articles/bakR-Quickstart.html">bakR for people in a hurry</a></li>
    <li><a class="dropdown-item" href="../articles/Differential-Synth.html">Differential synthesis analysis with bakR and DESeq2</a></li>
    <li><a class="dropdown-item" href="../articles/bakR-Fn.html">GRAND-SLAM output/fn estimates as bakR input</a></li>
    <li><a class="dropdown-item" href="../articles/Dropout.html">Correcting for dropout</a></li>
    <li><a class="dropdown-item" href="../articles/Troubleshooting.html">Troubleshooting analyses of NR-seq data with bakR</a></li>
    <li><a class="dropdown-item" href="../articles/NSS.html">Steady-state quasi-independent mechanistic investigations</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/simonlabcode/bakR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Estimating kinetic parameters from nucleotide recoding RNA-seq data</h1>
      <small class="dont-index">Source: <a href="https://github.com/simonlabcode/bakR/blob/master/R/Fitting_Models.R" class="external-link"><code>R/Fitting_Models.R</code></a></small>
      <div class="d-none name"><code>bakRFit.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>bakRFit</code> analyzes nucleotide recoding RNA-seq data to estimate
kinetic parameters relating to RNA stability and changes in RNA
stability induced by experimental perturbations. Several statistical
models of varying efficiency and accuracy can be used to fit data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">bakRFit</span><span class="op">(</span></span>
<span>  <span class="va">obj</span>,</span>
<span>  StanFit <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  HybridFit <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  high_p <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  totcut <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  totcut_all <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  Ucut <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>  AvgU <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  FastRerun <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  FOI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  concat <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  StanRateEst <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  RateEst_size <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  low_reads <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  high_reads <span class="op">=</span> <span class="fl">5e+05</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  NSS <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  Chase <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  BDA_model <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  multi_pold <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  Long <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  kmeans <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ztest <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  Fisher <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-obj">obj<a class="anchor" aria-label="anchor" href="#arg-obj"></a></dt>
<dd><p><code>bakRData</code> object produced by <code>bakRData</code>, <code>bakRFit</code> object produced by <code>bakRFit</code>
<code>bakRFnData</code> object produced by <code>bakRFnData</code>, or <code>bakRFnFit</code> object produced by <code>bakRFit</code>.</p></dd>


<dt id="arg-stanfit">StanFit<a class="anchor" aria-label="anchor" href="#arg-stanfit"></a></dt>
<dd><p>Logical; if TRUE, then the MCMC implementation is run. Will only be used if <code>obj</code>
is a <code>bakRFit</code> object</p></dd>


<dt id="arg-hybridfit">HybridFit<a class="anchor" aria-label="anchor" href="#arg-hybridfit"></a></dt>
<dd><p>Logical; if TRUE, then the Hybrid implementation is run. Will only be used if <code>obj</code>
is a <code>bakRFit</code> object</p></dd>


<dt id="arg-high-p">high_p<a class="anchor" aria-label="anchor" href="#arg-high-p"></a></dt>
<dd><p>Numeric; Any features with a mutation rate (number of mutations / number of Ts in reads) higher than this in any -s4U control
samples (i.e., samples that were not treated with s4U) are filtered out</p></dd>


<dt id="arg-totcut">totcut<a class="anchor" aria-label="anchor" href="#arg-totcut"></a></dt>
<dd><p>Numeric; Any features with less than this number of sequencing reads in any replicate of all experimental conditions are filtered out</p></dd>


<dt id="arg-totcut-all">totcut_all<a class="anchor" aria-label="anchor" href="#arg-totcut-all"></a></dt>
<dd><p>Numeric; Any features with less than this number of sequencing reads in any sample are filtered out</p></dd>


<dt id="arg-ucut">Ucut<a class="anchor" aria-label="anchor" href="#arg-ucut"></a></dt>
<dd><p>Numeric; All features must have a fraction of reads with 2 or less Us less than this cutoff in all samples</p></dd>


<dt id="arg-avgu">AvgU<a class="anchor" aria-label="anchor" href="#arg-avgu"></a></dt>
<dd><p>Numeric; All features must have an average number of Us greater than this cutoff in all samples</p></dd>


<dt id="arg-fastrerun">FastRerun<a class="anchor" aria-label="anchor" href="#arg-fastrerun"></a></dt>
<dd><p>Logical; only matters if a bakRFit object is passed to <code>bakRFit</code>. If TRUE, then the Stan-free
model implemented in <code>fast_analysis</code> is rerun on data, foregoing fitting of either of the 'Stan' models.</p></dd>


<dt id="arg-foi">FOI<a class="anchor" aria-label="anchor" href="#arg-foi"></a></dt>
<dd><p>Features of interest; character vector containing names of features to analyze</p></dd>


<dt id="arg-concat">concat<a class="anchor" aria-label="anchor" href="#arg-concat"></a></dt>
<dd><p>Logical; If TRUE, FOI is concatenated with output of reliableFeatures</p></dd>


<dt id="arg-stanrateest">StanRateEst<a class="anchor" aria-label="anchor" href="#arg-stanrateest"></a></dt>
<dd><p>Logical; if TRUE, a simple 'Stan' model is used to estimate mutation rates for fast_analysis; this may add a couple minutes
to the runtime of the analysis.</p></dd>


<dt id="arg-rateest-size">RateEst_size<a class="anchor" aria-label="anchor" href="#arg-rateest-size"></a></dt>
<dd><p>Numeric; if StanRateEst is TRUE, then data from RateEst_size genes are used for mutation rate estimation. This can be as low
as 1 and should be kept low to ensure maximum efficiency</p></dd>


<dt id="arg-low-reads">low_reads<a class="anchor" aria-label="anchor" href="#arg-low-reads"></a></dt>
<dd><p>Numeric; if StanRateEst is TRUE, then only features with more than low_reads reads in all samples will be used for mutation rate estimation</p></dd>


<dt id="arg-high-reads">high_reads<a class="anchor" aria-label="anchor" href="#arg-high-reads"></a></dt>
<dd><p>Numeric; if StanRateEst is TRUE, then only features with less than high_read reads in all samples will be used for mutation rate estimation.
A high read count cutoff is as important as a low read count cutoff in this case because you don't want the fraction labeled of chosen features to be
extreme (e.g., close to 0 or 1), and high read count features are likely low fraction new features.</p></dd>


<dt id="arg-chains">chains<a class="anchor" aria-label="anchor" href="#arg-chains"></a></dt>
<dd><p>Number of Markov chains to sample from. 1 should suffice since these are validated models. Running more chains is generally
preferable, but memory constraints can make this unfeasible.</p></dd>


<dt id="arg-nss">NSS<a class="anchor" aria-label="anchor" href="#arg-nss"></a></dt>
<dd><p>Logical; if TRUE, logit(fn)s are directly compared to avoid assuming steady-state</p></dd>


<dt id="arg-chase">Chase<a class="anchor" aria-label="anchor" href="#arg-chase"></a></dt>
<dd><p>Logical; Set to TRUE if analyzing a pulse-chase experiment. If TRUE, kdeg = -ln(fn)/tl where fn is the fraction of
reads that are s4U (more properly referred to as the fraction old in the context of a pulse-chase experiment).</p></dd>


<dt id="arg-bda-model">BDA_model<a class="anchor" aria-label="anchor" href="#arg-bda-model"></a></dt>
<dd><p>Logical; if TRUE, variance is regularized with scaled inverse chi-squared model. Otherwise a log-normal
model is used.</p></dd>


<dt id="arg-multi-pold">multi_pold<a class="anchor" aria-label="anchor" href="#arg-multi-pold"></a></dt>
<dd><p>Logical; if TRUE, pold is estimated for each sample rather than use a global pold estimate.</p></dd>


<dt id="arg-long">Long<a class="anchor" aria-label="anchor" href="#arg-long"></a></dt>
<dd><p>Logical; if TRUE, long read optimized fraction new estimation strategy is used.</p></dd>


<dt id="arg-kmeans">kmeans<a class="anchor" aria-label="anchor" href="#arg-kmeans"></a></dt>
<dd><p>Logical; if TRUE, kmeans clustering on read-specific mutation rates is used to estimate pnews and pold.</p></dd>


<dt id="arg-ztest">ztest<a class="anchor" aria-label="anchor" href="#arg-ztest"></a></dt>
<dd><p>Logical; if TRUE and the MLE implementation is being used, then a z-test will be used for p-value calculation
rather than the more conservative moderated t-test.</p></dd>


<dt id="arg-fisher">Fisher<a class="anchor" aria-label="anchor" href="#arg-fisher"></a></dt>
<dd><p>Logical; if TRUE, Fisher information is used to estimate logit(fn) uncertainty. Else, a less conservative binomial model is used, which
can be preferable in instances where the Fisher information strategy often drastically overestimates uncertainty
(i.e., low coverage or low pnew).</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed to either <code>fast_analysis</code> (if a bakRData object)
or <code>TL_Stan</code> and <code>Hybrid_fit</code> (if a bakRFit object)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>bakRFit object with results from statistical modeling and data processing. Objects possibly included are:</p><ul><li><p>Fast_Fit; Always will be present. Output of <code>fast_analysis</code></p></li>
<li><p>Hybrid_Fit; Only present if HybridFit = TRUE. Output of <code>TL_stan</code></p></li>
<li><p>Stan_Fit; Only present if StanFit = TRUE. Output of <code>TL_stan</code></p></li>
<li><p>Data_lists; Always will be present. Output of <code>cBprocess</code> with Fast and Stan == TRUE</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>If <code>bakRFit</code> is run on a bakRData object, <code>cBprocess</code>
and then <code>fast_analysis</code> will always be called. The former will generate the processed
data that can be passed to the model fitting functions (<code>fast_analysis</code>
and <code>TL_Stan</code>). The call to <code>fast_analysis</code> will generate a list of dataframes
containing information regarding the <code>fast_analysis</code> fit. <code>fast_analysis</code> is always
called because its output is required for both <code>Hybrid_fit</code> and <code>TL_Stan</code>.</p>
<p>If <code>bakRFit</code> is run on a bakRFit object, <code>cBprocess</code> will not be called again,
as the output of <code>cBprocess</code> will already be contained in the bakRFit object. Similarly,
<code>fast_analysis</code> will not be called again unless bakRFit is rerun on the bakRData object.
or if <code>FastRerun</code> is set to TRUE. If you want to generate model fits using different parameters for cBprocess,
you will have to rerun <code>bakRFit</code> on the bakRData object.</p>
<p>If <code>bakRFit</code> is run on a bakRFnData object, <code>fn_process</code> and then <code>avg_and_regularize</code>
will always be called. The former will generate the processed data that can be passed to the model
fitting functions (<code>avg_and_regularize</code> and <code>TL_Stan</code>, the latter only with HybridFit = TRUE).</p>
<p>If <code>bakRFit</code> is run on a bakRFnFit object. <code>fn_process</code> will not be called again, as
the output of <code>fn_process</code> will already be contained in the bakRFnFit object. Similary,
<code>avg_and_regularize</code> will not be called unless <code>bakRFit</code> is rerun on the bakRData object,
or if <code>FastRerun</code> is set to TRUE. If you want to generate model fits using different
parameters for <code>fn_process</code>, you will have to rerun <code>bakRFit</code> on the bakRData object.</p>
<p>See the documentation for the individual fitting functions for details regarding how they analyze nucleotide
recoding data. What follows is a brief overview of how each works</p>
<p><code>fast_analysis</code> (referred to as the MLE implementation in the bakR paper)
either estimates mutation rates from + and (if available) - s4U samples or uses mutation rate estimates
provided by the user to perform maximum likelihood estimation (MLE) of the fraction of RNA that is labeled for each
replicate of nucleotide recoding data provided. Uncertainties for each replicate's estimate are approximated using
asymptotic results involving the Fisher Information and assuming known mutation rates. Replicate data
is pooled using an approximation to hierarchical modeling that relies on analytic solutions to simple Bayesian models.
Linear regression is used to estimate the relationship between read depths and replicate variability for uncertainty
estimation regularization, again performed using analytic solutions to Bayesian models.</p>
<p><code>TL_Stan</code> with Hybrid_Fit set to TRUE (referred to as the Hybrid implementation in the bakR paper)
takes as input estimates of the logit(fraction new) and uncertainty provided by <code>fast_analysis</code>.
It then uses 'Stan' on the backend to implement a hierarchical model that pools data across replicates and the dataset
to estimate effect sizes (L2FC(kdeg)) and uncertainties. Replicate variability information is pooled across each experimental
condition to regularize variance estimates using a hierarchical linear regression model.</p>
<p>The default behavior of <code>TL_Stan</code> (referred to as the MCMC implementation in the bakR paper)
is to use 'Stan' on the back end to implement a U-content exposure adjusted Poisson mixture model
to estimate fraction news from the mutational data. Partial pooling of replicate variability estimates
is performed as with the Hybrid implementation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Simulate data for 1000 genes, 2 replicates, 2 conditions</span></span></span>
<span class="r-in"><span><span class="va">simdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="Simulate_bakRData.html">Simulate_bakRData</a></span><span class="op">(</span><span class="fl">1000</span>, nreps <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You always must fit fast implementation before any others</span></span></span>
<span class="r-in"><span><span class="va">Fit</span> <span class="op">&lt;-</span> <span class="fu">bakRFit</span><span class="op">(</span><span class="va">simdata</span><span class="op">$</span><span class="va">bakRData</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finding reliable Features</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Filtering out unwanted or unreliable features</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing data...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimating pnew with likelihood maximization</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimating unlabeled mutation rate with -s4U data</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated pnews and polds for each sample are:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 4 × 4</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># Groups:   mut [2]</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     mut  reps   pnew     pold</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>     1     1 0.050<span style="text-decoration: underline;">1</span> 0.000<span style="text-decoration: underline;">999</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>     1     2 0.049<span style="text-decoration: underline;">8</span> 0.000<span style="text-decoration: underline;">999</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span>     2     1 0.050<span style="text-decoration: underline;">0</span> 0.000<span style="text-decoration: underline;">999</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span>     2     2 0.050<span style="text-decoration: underline;">1</span> 0.000<span style="text-decoration: underline;">999</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimating fraction labeled</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimating per replicate uncertainties</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimating read count-variance relationship</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Averaging replicate data and regularizing estimates</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Assessing statistical significance</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> All done! Run QC_checks() on your bakRFit object to assess the </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             quality of your data and get recommendations for next steps.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Isaac Vock.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

